# チュートリアル
Tinyterpでできることを簡単に解説します。

## どのような言語か
動的型付け、第一級関数をサポートする言語であり、tree-walking方式のインタプリタでコードが実行される。
また、Lisp程ではないが非常に言語としての設計がシンプルであり、シンプルさと書きやすさを両立している言語ともいえる。
シンプルすぎるため、print関数すら純粋なtinyterpには存在しない。
このチュートリアルでは、print関数が任意の文字列を標準出力に出力する関数であることを前提として話を進める。

この言語の主な利用用途としては、テキストエディタにマクロ機能として組み込んだり、チャットボットのコマンド機能を拡張したりなどである。

## 構文
```
# #から改行までの区間は無視される。（コメント。）
print("hello");
print("world");
# セミコロンで式を区切ることができ、左から順番に評価される。
```

### リテラル
```
nil; # nil。JavaScriptで言うところのnull。
true; # bool。trueまたはfalseは真偽値を表す。
42; # int。整数。64ビット符号付整数の範囲で値を設定可能。
1.0; # float。浮動小数点数。64ビット浮動小数点数。
"this is string"; # str。文字列。
[1, 2.0, "third"]; # list。配列。
{"key1" -> "value1", "key2" -> 2}; # hash。連想配列。
(x) -> {x + 1}; # function。関数。
```

### 変数への値の束縛と解放
値を変数に束縛する。
イコールの右辺と左辺の個数が等しく、2個以上の時は多重代入として処理される。
変数名には、ラテン文字の大文字と小文字、アラビア数字、アンダースコア(`_`)が使用可能であるが、先頭にアラビア数字を使うことはできない。
また、予約語は使用不可能である。
```
a = 1 # 変数aに1を束縛する。戻り値は1。
a, b = 1, 2; # 変数aに1, bに2を束縛する。(多重代入) 戻り値は [1, 2]。
drop a; # 変数aを解放する。
```

#### 使用可能な変数名の例
- `a`
- `A`
- `ABCDEF`
- `variable`
- `ThisIsVariable123`
- `_v`

#### 使用不可能な変数名の例
- `42`
- `へんすう`
- `1_a_b_c_d`

#### 予約語(制御構文などに使用するため、変数名としては使用できない。)
- `if`
- `then`
- `else`
- `not`
- `and`
- `or`
- `return`
- `nil`
- `true`
- `false`
- `drop`

### 演算子

四則演算
```
(1 + 2) * 3 / (4 - 2); # int, float は、このような四則演算を行うことができる。
```

負号, 指数
```
-a # aに-1を乗算する。
a ** 2; # aの2乗。
```

論理演算

`not`, `and`, `or` の演算が利用可能。
```
not a or b and; c # のような論理演算が可能である。
```

比較

`<`, `>`, `<=`, `>=`, `==`, などの演算が使える。
なお、`==` は、右辺と左辺が等しい時true、そうでなければfalseを返す演算子である。
```
a >; b # a は b より大きいか？
```

### 関数の定義と呼び出し

Tinyterpには関数を定義する構文は存在しないが、無名関数と値の束縛を使って関数を定義することができる。

```
add_one = (x) -> {x + 1};
```

また、関数に対して括弧をつけ、任意の数の引数を入れることにより、関数を評価できる。
```
add_one(1);
```

関数に関数を渡すことも可能。
```
twice = (f) -> {f(); f()};
say_hello = () -> {print("hello")};
twice(say_hello);
```

#### 引数の評価タイミング
引数は呼び出し時のスコープで評価される

#### キーワード引数

関数の引数にデフォルトの値を指定する事が可能。
```
add = (x, a=1) -> {x + a};
```
キーワード引数も呼び出し時のスコープで評価される。

### ブロックとreturn
さきほどから波括弧を使用しているが、hashのリテラルではい場合の波括弧では共通して、以下のような性質を持っている。
- セミコロンまたは改行で区切り式を書くことができる。
- `return` を書かない場合は、一番最後に評価した結果が戻り値となる。
```
{1; 2}; # -> 2
```
- `return 式` で強制的に評価を停止し、値を返す事ができる。
```
{1; return 2; 3}; # -> 2
```
- 波括弧を省略しているが、プログラム全体がブロックとして解釈されるため、関数などの外で`return`するとプログラムが停止する。

#### 多重のブロックを抜ける
return を複数回重ねて使用することで多重のブロックを抜けられる
```
{{return return 1; 2}; 3}; #-> 1
```
returnを一つ消費してブロックを一つ抜けるというような形である
ifはreturnを消費しない。


### if 式
`if 条件式 then A else B` の形で書く。 
条件が真の時はAが評価され、そうでなければBが、評価されて戻り値となる。
なお、`then`と B は省略可能である。

条件式は、`nil` か `false` の場合のみ偽とみなし、それ以外は真とみなす。
`if` の A, B にブロックが与えられた場合、それらの中で`return`しても**returnを消費しない。**
```
# 一行で書くこともできるし...
if a == 1 then print("a is one.") else print("a is not one.")
# C言語のような書き方もできる。
if (a == 1) {
    print("a is one.");
} else {
    print("a is not one");
}
```

### loop 式
波括弧内を無限ループする。`return 式`で値を返す事ができる。
```
counter = 0;
loop {
    print("hello");
    counter = counter + 1;
    if counter > 10 then break;
}
```

### 配列(list)
配列として機能する方
配列は以下のようにして初期できる。
異なる方の値を入れることもできる。
```
[42, "hello", ["world", 2.71]];
```
配列の要素を取得するには以下のようにする。
```
a = ["one", "two", "three"];
a[0]; #-> "one"
```

### 連想配列(hash)
hashはkeyとvalueがペアになったリストのようなものである。
keyとしては文字列(str)のみが利用可能である。

### 組み込み関数・変数一覧

#### 型とキャスト
|  関数名  |  挙動  |
| - | - |
| type(a) | aの型名をstrで返す。 |
| str(a) | aをstr型に変換して返す。 |
| int(a) | aをint型に変換して返す。 |
| float(a) | aをfloat型に変換して返す。 |

#### 数学
|  関数名  |  挙動  |
| ---- | ---- |
|  abs(a)  |  aの絶対値  |
|  ln(a)  |  ln(a)  |
|  exp(a)  | eのa乗。ただしeはネイピア数。 |
|  sin(a)  |  sin(a)  |
|  cos(a)  |  cos(a)  |
|  tan(a)  |  tan(a)  |
|  asin(a)  |  asin(a)  |
|  acos(a)  |  acos(a)  |
|  atan(a)  |  atan(a)  |
|  sinh(a)  |  sinh(a)  |
|  cosh(a)  |  cos(a)  |
|  tanh(a)  |  tanh(a)  |
| mod(a, b) | aをbで除算した余りを返す。 |
| pi | π (円周率) |

